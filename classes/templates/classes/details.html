{% extends 'classes/layout.html' %}

{% block content %}

{% if building %}
<div class="card">
    <div class="card-content">
        {{building.building}}
    </div>
</div>
{% else %}
    <h6 class="center-align">{{classe}}</h6>
	<div class="container" bgcolor="#000000">
    <div class="card">
        <div class="card-content">
            {{classe.building}} {{classe.room}} {{classe.day}}
        </div>
    </div>
		</div>
{% endif %}

<form method="GET" action="{% url 'classes:search' %}">
    <input name = "q" value="{{request.GET.q}}" placeholder="Search dept/course num... ex: COS 333">
    <button class="btn btn-success" type="submit">
        Search
    </button>
</form>

<html>
<head>
  <title>ClassMaps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="http://leafletjs.com/examples/layers-control/docs/images/favicon.ico">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
  <style>
    #map { width: 100%; height: 600px; }
  </style>
</head>
<body>

  <div id="map"></div>

<script>
  {% if building %}
    var c = "{{building.building}}";
    var d = "";
    var loc2 = "{{building.building_lon}}";
    var loc1 = "{{building.building_lat}}";
  {% else %}
    var c = "{{classe.building}}";
    var d = "{{classe.room}}";
    var loc2 = "{{classe.building_lon}}";
    var loc1 = "{{classe.building_lat}}";
  {% endif %}

  // Adds different layer groups
  var printers = L.layerGroup();

  // initialize the map
  // URLS of maps for different laters (note: need to add attributes)
  var mbAttr = 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
    mbUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'

  // Different layers
  var regular   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr})

  // Initializes the map
  var map = L.map('map', {
    center: [40.346, -74.653],
    zoom: 16,
    layers: [regular, printers]
  });

   map.locate({setView: true,watch: true, maxZoom: 16});
    function onLocationFound(e) {
    var radius = e.accuracy / 2;
    L.marker(e.latlng).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point").openPopup();
    L.circle(e.latlng, radius).addTo(map);
    }
    map.on('locationfound', onLocationFound);
    
  L.marker([loc1, loc2]).addTo(map)
    .bindPopup(c + " " + d).openPopup();
  L.circle([loc1, loc2], 5, {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5
  }).addTo(map)
  var popup = L.popup();

  function onMapClick(e) {
    popup
      .setLatLng(e.latlng)
      .setContent("You clicked the map at " + e.latlng.toString())
      .openOn(map);
  }
  map.on('click', onMapClick);

  // Our different layers
  var baseLayers = {
    "Regular": regular
  };

  // Our overlays
  var overlays = {
    "Printers": printers
  };

  // Adds overlays and layers to map
  L.control.layers(baseLayers, overlays).addTo(map);

  // Limits zoom (we could get rid of this)
  map.options.minZoom = 14;
  map.options.maxZoom = 18;

  // Displays current user location and accuracy
  function onLocationFound(e) {
    var radius = e.accuracy / 2;

    L.marker(e.latlng).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point").openPopup();

    L.circle(e.latlng, radius).addTo(map);
  }
  map.on('locationfound', onLocationFound);
</script>
</body>
</html>

<a href="/classes" class="btn">Go back</a>
{% endblock %}
